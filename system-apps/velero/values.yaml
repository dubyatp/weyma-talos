velero:
  backupsEnabled: true
  snapshotsEnabled: false
  namespace:
    labels:
    - key: pod-security.kubernetes.io/enforce
      value: privileged
    - key: pod-security.kubernetes.io/enforce-version
      value: latest
    - key: pod-security.kubernetes.io/audit
      value: privileged
    - key: pod-security.kubernetes.io/audit-version
      value: latest
    - key: pod-security.kubernetes.io/warn
      value: privileged
    - key: pod-security.kubernetes.io/warn-version
      value: latest
  metrics:
    labels:
      metrics_enabled: "true"
  configuration:
    backupStorageLocation:
    - name: weyma-truenas
      provider: velero.io/aws
      bucket: weyma-talos-velero
      default: true
      credential:
        name: weyma-truenas-s3-auth
        key: credentials
      config:
        s3Url: "http://10.105.15.20:9000"
        region: minio
        insecureSkipTLSVerify: "true"
  initContainers:
  - name: velero-plugin-for-aws
    image: velero/velero-plugin-for-aws:v1.12.1
    imagePullPolicy: IfNotPresent
    volumeMounts:
      - mountPath: /target
        name: plugins
  deployNodeAgent: true
  configMaps:
    default-storageclass:
      labels:
        velero.io/plugin-config: ""
        velero.io/change-storage-class: RestoreItemAction
      data:
        ceph-block: weyma-shared
  extraObjects:
  - apiVersion: external-secrets.io/v1beta1
    kind: ExternalSecret
    metadata:
      name: weyma-truenas-s3-auth
      namespace: velero
    spec:
      refreshInterval: 1h
      secretStoreRef:
        name: weyma-vault
        kind: ClusterSecretStore
      target:
        name: weyma-truenas-s3-auth
        creationPolicy: Owner
      data:
      - secretKey: credentials
        remoteRef:
          key: velero
          property: credentials